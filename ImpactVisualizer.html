<!DOCTYPE html>
<html>
<head>
  <title>Green Heroes Impact Visualizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #e6f7e6; color: #333; padding: 15px; }
    h1 { color: #2d7a2d; text-align:center; font-size: 22px; }
    label { display:block; margin-top:12px; font-weight:bold; font-size: 16px;}
    input, select { width: 100%; padding: 10px; margin-top:5px; border-radius:5px; border:1px solid #ccc; font-size: 16px; }
    button { margin-top:20px; padding:12px; width:100%; background:#2d7a2d; color:white; border:none; font-size:16px; border-radius:5px; cursor:pointer; }
    .results { margin-top:20px; background:#fff; padding:15px; border-radius:10px; font-size: 15px; }
    .highlight { color:#2d7a2d; font-weight:bold; }
    .hidden { display:none; }
    .forest { font-size: 36px; text-align:center; margin-top:10px; }
    .emoji { font-size: 48px; text-align:center; margin-top:10px; }
    .nav-btn {
      margin: 10px;
      padding: 12px 20px;
      background: #2d7a2d;
      color: #fff;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .nav-btn:hover { background: #249424; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transform: translateY(-2px); }
    .nav-btn:active { background: #1e6b1e; transform: translateY(0); }
  </style>
</head>
<body>

<h1>Green Heroes: Impact Visualizer</h1>

<form id="impactForm">
  <label>Are you vegetarian or non-vegetarian?</label>
  <select name="diet" id="diet" onchange="
      document.getElementById('nonVegFields').classList.toggle('hidden', this.value==='veg');">
    <option value="veg">Vegetarian</option>
    <option value="nonveg">Non-Vegetarian</option>
  </select>

  <label>Total number of family members:</label>
  <input type="number" id="familyMembers" min="1" value="1">

  <div id="nonVegFields" class="hidden">
    <label>Number of non-vegetarians in your family:</label>
    <input type="number" id="nonVegMembers" min="1" value="1">

    <label>This week: How often do you consume meat? (times per week)</label>
    <input type="number" id="frequencyWeek" min="0" value="1">

    <label>This week: Average quantity per meal (kg)</label>
    <input type="number" id="quantityWeek" min="0" step="0.01" value="0.1">

    <label>Last week: How often did you consume meat? (times per week)</label>
    <input type="number" id="lastFrequencyWeek" min="0" value="1">

    <label>Last week: Average quantity per meal (kg)</label>
    <input type="number" id="lastQuantityWeek" min="0" step="0.01" value="0.1">

    <label>How do you want to contribute?</label>
    <select id="contribution">
      <option value="health">Health</option>
      <option value="environment">Environment</option>
      <option value="both">Both</option>
    </select>
  </div>

  <button type="submit">Calculate Impact</button>
</form>

<div id="results" class="results hidden"></div>
<div class="forest" id="forest"></div>
<div class="emoji" id="emojiFace"></div>

<div id="extraButtons" class="hidden" style="margin-top:20px; text-align:center;">
  <button class="nav-btn" onclick="window.location.href='https://ronika31409.github.io/Green-Heroes/'">üçΩ Meal Planner</button>
  <button class="nav-btn" onclick="window.location.href='https://ronika31409.github.io/Green-Heroes/GreenHeroesChallenges'">üî• Challenges</button>
</div>

<script>
const ESP32_IP = "192.168.1.37"; // Replace with your ESP32 IP

document.getElementById("impactForm").onsubmit = async function(e) {
  e.preventDefault();

  const diet = document.getElementById('diet').value;
  const totalFamily = parseInt(document.getElementById('familyMembers').value) || 1;
  const resultsDiv = document.getElementById('results');
  const forestDiv = document.getElementById('forest');
  const emojiDiv = document.getElementById('emojiFace');

  let emojiFace = "";
  let forest = "";
  let msgs = [];
  let suggestion = "";
  let rewardMsg = "";

  if(diet === "veg") {
    emojiFace = "üòÑ"; forest = "üå±üå±üå±";
    resultsDiv.innerHTML = '<p class="highlight">Great! Your household is vegetarian. Your meat-related impact is zero.</p>';
  } else {
    const nonVegMembers = parseInt(document.getElementById('nonVegMembers').value)||1;
    const freqWeek = parseInt(document.getElementById('frequencyWeek').value)||0;
    const qtyWeek = parseFloat(document.getElementById('quantityWeek').value)||0;
    const lastFreqWeek = parseInt(document.getElementById('lastFrequencyWeek').value)||0;
    const lastQtyWeek = parseFloat(document.getElementById('lastQuantityWeek').value)||0;
    const contrib = document.getElementById('contribution').value;

    const totalKgWeek = qtyWeek*freqWeek*52*nonVegMembers;
    const lastTotalKgWeek = lastQtyWeek*lastFreqWeek*52*nonVegMembers;
    const reduction = lastTotalKgWeek - totalKgWeek;

    const co2 = totalKgWeek*15;
    const water = totalKgWeek*15000;
    const land = totalKgWeek*3;
    const heartRisk = ((qtyWeek*freqWeek*nonVegMembers)/10).toFixed(1);
    const cancerRisk = ((qtyWeek*freqWeek*nonVegMembers)/20).toFixed(1);

    msgs.push(co2<100?'üåç CO‚ÇÇ: Small impact, but every bit counts!':co2<500?'üåç CO‚ÇÇ: Same as driving a car ~40 km.':co2<1000?'üåç CO‚ÇÇ: Enough to drive a small car 80-100 km!':'üåç CO‚ÇÇ: Very high! Could cause lung & climate effects.');
    msgs.push(water<5000?'üíß Water: Small amount, but you can save more!':water<50000?'üíß Water: Enough for 25 people for a day!':water<150000?'üíß Water: Enough for 1 person for a year!':'üíß Water: Could supply a small town for a week!');
    msgs.push(land<50?'üåæ Land: Very small impact.':land<150?'üåæ Land: About the size of a small apartment floor.':land<500?'üåæ Land: Could plant 100 trees!':'üåæ Land: Equivalent to a large farm area!');

    suggestion = totalKgWeek<=10?'‚úÖ Great! Keep reducing meat gradually.':totalKgWeek<=30?'‚ö† Moderate impact. Try substituting some meals with pulses.':'‚ùå High impact! Consider cutting down meat significantly for health & environment.';
    if(reduction>10) rewardMsg='üéâ Congrats! You cut down your meat consumption this week and earned a 10% discount at MillionsTaste!';

    if(totalKgWeek<=10){forest='üå≤üå≥üå≤'; emojiFace='üòÑ';}
    else if(totalKgWeek<=30){forest='üå±üå≥üå±'; emojiFace='üòê';}
    else if(totalKgWeek<=50){forest='üå±üå±üå±'; emojiFace='üòü';}
    else {forest='üî•üî•üî•'; emojiFace='üò≠';}

    resultsDiv.innerHTML = `<h2>Your Household Impact (This Week)</h2>
      <p>Total meat consumed per year extrapolated: <span class="highlight">${totalKgWeek.toFixed(2)} kg</span></p>
      <p>üåç CO‚ÇÇ emitted: <span class="highlight">${co2.toFixed(0)} kg</span></p>
      <p>üíß Water used: <span class="highlight">${water.toLocaleString()} liters</span></p>
      <p>üåæ Land used: <span class="highlight">${land.toFixed(0)} m¬≤</span></p>
      <p>Health risk: Heart disease +${heartRisk}%, Cancer +${cancerRisk}%</p>
      <p>Contribution goal: <span class="highlight">${contrib}</span></p>
      <p>Impact insights:</p><ul><li>${msgs[0]}</li><li>${msgs[1]}</li><li>${msgs[2]}</li></ul>
      <p class="highlight">${suggestion}</p>
      <p class="highlight">${rewardMsg}</p>`;
  }

  forestDiv.innerHTML = forest;
  emojiDiv.innerHTML = emojiFace;
  resultsDiv.classList.remove('hidden');
  document.getElementById('extraButtons').classList.remove('hidden');

  // Send emoji to ESP32 TFT
  try {
    await fetch(`http://${ESP32_IP}/emoji?face=${encodeURIComponent(emojiFace)}`);
  } catch(err) {
    console.log("ESP32 not reachable:", err);
  }
};
</script>

</body>
</html>
